# SuperSlides Progress Report — February 15, 2026

## Overview
Today’s work delivered a major expansion of table tooling, added two new formatting workflows (Replace Font and Bulk Recolor), and refined modal UX behavior based on runtime feedback.

Implemented themes:
1. Table operations expansion (swap, transpose, sort)
2. Formatting-preserving payload architecture for table content movement
3. Replace Font feature (full flow + final UX tweak)
4. Bulk Recolor feature (category-aware color remapping)
5. Sidebar + dialog architecture improvements
6. Documentation and API reference updates

---

## 1. Table Swap Foundation

### Added actions
- `Swap Rows in Table`
- `Swap Columns in Table`

### Server APIs
- `swapTableRows(rowA, rowB, keepFormatting)`
- `swapTableColumns(colA, colB, keepFormatting)`

### Core helpers
- `getSelectedTableForSwap_()`
- `validateTableIndex_()`
- `swapCells_()`
- `isMergedCell_()`

### Behavior
- 1-based row/column input from UI
- Bounds validation against real table dimensions
- No-op message when swapping identical indexes
- Table resolution:
  - use exactly one selected table when present
  - fallback to the only table on current slide when unambiguous

---

## 2. Formatting-Preservation Architecture (Table Operations)

Introduced robust snapshot/apply helpers so table operations can move content with style context.

### Added helpers
- `safeGet_()`
- `captureColorSpec_()` / `applyTextColorSpec_()`
- `captureTextStyleSnapshot_()` / `applyTextStyleSnapshot_()`
- `captureParagraphStyleSnapshot_()` / `applyParagraphStyleSnapshot_()`
- `captureCellPayload_()` / `applyCellPayload_()`

### Preserved when enabled
- text run styles (font, size, links, emphasis, etc.)
- paragraph styles
- cell fill
- cell content alignment

### Constraint retained
- Border transfer is still not supported in current Apps Script approach.

---

## 3. Runtime Stability Fixes

### Merge-state enum issue
- Fixed runtime error around direct merge-state enum usage by normalizing merge-state reads through string comparison in `isMergedCell_()`.

### Table insertion signature issue
- Fixed invalid insert signature path by inserting tables with supported API patterns, then positioning via setters.

---

## 4. New Table Feature: Transpose Table

### Added action
- `Transpose Table`

### Server API
- `transposeTable(transposeHeader, keepFormatting, slotInNewSlide)`

### Behavior
- Default: replace source table **in place** with transposed output
- Optional: slot transposed result on a duplicated slide
- Supports header-transpose mode toggle
- Supports keep-formatting mode
- Blocks merged-cell transpose with clear messaging

### Added helpers
- `insertTableAtPosition_()`
- `getTableIndexOnSlide_()`
- `duplicateSlideAfter_()`
- `buildTransposeMatrix_()`

---

## 5. New Table Feature: Sort Table (Header-Aware)

### Added action
- `Sort Table`

### Server API
- `sortTable(sortColumn, sortOrder, keepFormatting)`

### Behavior
- Row 1 fixed as header (never moved)
- Sorts data rows only by selected column
- Supports ascending/descending
- Blank keys sorted last
- Type detection priority: number → date → text
- Stable tie-break on original row order
- Keep-formatting mode moves row payload with content

### Added helpers
- `captureRowPayload_()`
- `applyRowPayload_()`
- `parseSortableKey_()`
- `compareSortableKeys_()`

---

## 6. Matrix Alignment UX Update

### UX change
- Matrix settings moved to a popup/modal flow for better input handling.

### Sidebar wiring
- `Arrange in Matrix` now launches a focused settings interaction instead of only inline controls.

---

## 7. New Text Feature: Replace Font

### Added sidebar launcher
- `runOpenReplaceFontDialog()`

### Server APIs
- `getReplaceFontDialogData()`
- `replaceFontInPresentation(request)`
- `showReplaceFontDialog()`

### Added dialog file
- `src/ReplaceFontDialog.html`

### Functional behavior
- Source font dropdown populated from detected fonts in presentation
- Target font from curated list + `Custom...` input
- Supports size delta (negative/positive/zero)
- Restrict modes:
  - `ALL_TEXT`
  - `SHAPES_ONLY`
  - `TABLES_ONLY`
- Scope modes:
  - `ENTIRE_PRESENTATION`
  - `SELECTED_SLIDES`
- Case-insensitive font-family matching
- Size delta applies only to replaced runs
- Font size clamp at minimum `1pt`
- Recursive traversal includes grouped elements

### Final UX refinement (latest)
- Result/status messaging is bolded for emphasis
- Dialog no longer auto-closes after replace
- Explicit `Done` button closes dialog when user is ready
- Flow now mirrors Docs-style explicit completion

---

## 8. New Formatting Feature: Bulk Recolor

### Added sidebar launcher
- `runOpenBulkRecolorDialog()`

### Server APIs
- `getBulkRecolorDialogData()` — scans all slides and returns `{ fontColors, fillColors, outlineColors }` arrays of unique sorted hex strings
- `bulkRecolorPresentation(request)` — applies per-category color replacements with scope support; returns summary string
- `showBulkRecolorDialog()` — opens modal dialog (580×640px)

### Added dialog file
- `src/BulkRecolorDialog.html`

### Core color helper
- `resolveHexFromColor_(colorObj)` — extracts normalized uppercase hex (`#RRGGBB`) from Slides Color objects; handles both RGB and Theme color types via `safeGet_()`, skips unresolvable theme colors

### Color collection helpers (scan phase)
- `collectColorsFromPageElement_(element, colorSets)` — recursive dispatcher: Groups→recurse, Shapes→fill/outline/text, Tables→cell fill/cell text
- `collectFillColor_(shape, fillColorMap)` — reads `shape.getFill().getSolidFill().getColor()`
- `collectOutlineColor_(shape, outlineColorMap)` — reads `shape.getBorder().getLineFill().getSolidFill().getColor()`
- `collectCellFillColor_(cell, fillColorMap)` — reads `cell.getFill().getSolidFill().getColor()`
- `collectTextForegroundColors_(textRange, fontColorMap)` — iterates text runs, reads `getTextStyle().getForegroundColor()`

### Color replacement helpers (apply phase)
- `normalizeColorMap_(map)` — uppercases keys, filters out same-color entries
- `processPageElementForRecolor_(element, request, counters)` — recursive dispatcher matching scan pattern
- `recolorShapeFill_(shape, fillMap, counters)` — reads current fill hex → lookup → `fill.setSolidFill(newHex)`
- `recolorShapeOutline_(shape, outlineMap, counters)` — reads current outline hex → lookup → `lineFill.setSolidFill(newHex)`
- `recolorCellFill_(cell, fillMap, counters)` — reads current cell fill hex → lookup → `fill.setSolidFill(newHex)`
- `recolorTextForeground_(textRange, fontMap, counters)` — iterates runs, reads foreground hex → lookup → `style.setForegroundColor(newHex)`

### Dialog UI architecture
- Category tab bar: All / Font / Fill / Outline — filters the scrollable color inventory
- Each row: 24×24 color swatch + monospace hex label + category badges (in All view) + HTML5 color picker + clear button
- **Independent picks per category** — state keyed as `"font:#FF0000"`, `"fill:#FF0000"`, etc.
  - Font tab picks only affect font colors
  - Fill tab picks only affect fill colors
  - Outline tab picks only affect outline colors
  - All tab sets picks for every category where the color appears
- Scope selector: Entire Presentation / Selected Slides (reuses `resolveSlidesForReplaceScope_()`)
- Changed rows highlighted with blue background + new-color swatch preview
- Replace button builds per-category `{old→new}` maps from `userPicks` and sends to `bulkRecolorPresentation()`
- Dialog stays open after replace; Done button closes via `google.script.host.close()`

### Counter-based reporting
- Tracks `fontColorsReplaced`, `fillColorsReplaced`, `outlineColorsReplaced`, `failures`
- Summary format: "Replaced 12 font color(s), 5 fill(s), 3 outline(s) across 8 slide(s)."

### Edge cases handled
- Transparent/gradient/no-fill → `getSolidFill()` returns null → skipped
- Theme colors → attempted RGB resolution, skipped if unresolvable
- Grouped shapes → recursive traversal
- Table cells → cell fill counted under Fill category, cell text under Font category
- Same old=new color → filtered out by `normalizeColorMap_()`
- No colors found → status shows message, Replace button disabled
- No picks selected → client-side validation prevents empty submission

---

## 9. Sidebar UI Additions

### New/updated controls
- Table section:
  - Swap Rows in Table
  - Swap Columns in Table
  - Transpose Table
  - Sort Table
- Text/formatting section:
  - Replace Font
  - Bulk Recolor

### New/updated client handlers
- `showTableSwapDialog()` / `runTableSwap()`
- `showTableTransposeDialog()` / `runTransposeTable()`
- `showTableSortDialog()` / `runSortTable()`
- `runOpenReplaceFontDialog()`
- `runOpenBulkRecolorDialog()`

---

## 10. Documentation Updates

### `FEATURES.md` updates
- Expanded TOC and section structure
- Added full sections for:
  - Transpose Table
  - Sort Table
  - Replace Font
  - Bulk Recolor
- Updated matrix usage docs to popup flow
- Expanded API reference tables (server + client)
- Added/updated limitations for:
  - transpose/sort
  - replace font
  - formatting boundaries
- Updated file-structure section with new dialog files

---

## 11. Files Updated Today

- `src/Code.gs`
- `src/Sidebar.html`
- `src/ReplaceFontDialog.html`
- `src/BulkRecolorDialog.html`
- `FEATURES.md`
- `progress-2026-02-15.md`

---

## Notes
- Border transfer for table workflows remains out of scope.
- Merged-cell scenarios are intentionally guarded with explicit error messaging where operations are ambiguous.
- Replace Font and Bulk Recolor now follow explicit-completion dialog UX with a `Done` close action.
